.. _release-v19-0-0:

Fall 2019 Release (v19_0_0)
===========================

+-------------------------------------------+------------+
| Source                                    | Identifier |
+===========================================+============+
| Git tag                                   | 19.0.0     |
+-------------------------------------------+------------+
| :doc:`EUPS distrib </install/newinstall>` | v19\_0\_0  |
+-------------------------------------------+------------+

- :ref:`release-v19-0-0-functionality`
- :ref:`release-v19-0-0-interface`
- :ref:`release-v19-0-0-pending-deprecations`
- :ref:`release-v19-0-0-deprecations`

*See also:*


- :doc:`Installation instructions <../install/index>`
- :doc:`Known issues </known-issues>`
- `Characterization Metric Report (DMTR-191) <https://ls.st/DMTR-191>`_
- `Doxygen Documentation <http://doxygen.lsst.codes/stack/doxygen/xlink_master_2019_11_16_09.13.30/>`_

These release notes highlight significant changes to the Science Pipelines codebase which are likely to be of wide interest.
For a complete list of changes made, see :ref:`release-v19-0-0-tickets`.

.. _release-v19-0-0-functionality:

Major Functionality Changes
---------------------------



.. _release-v19-0-0-interface:

Significant Interface Changes
-----------------------------

- :ref:`release-v19-0-0-exposureinfo`
- :ref:`release-v19-0-0-gen3-api`
- :ref:`release-v19-0-0-pipetask`
- :ref:`release-v19-0-0-isr`
- :ref:`release-v19-0-0-calib-compat`
- :ref:`release-v19-0-0-ap-silent`
- :ref:`release-v19-0-0-test-util`
- :ref:`release-v19-0-0-pytest`
- :ref:`release-v19-0-0-adn`
- :ref:`release-v19-0-0-mosaic`

.. _release-v19-0-0-exposureinfo:

Upgrades to `lsst.afw.image.ExposureInfo`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

As part of an ongoing project to make `~lsst.afw.image.ExposureInfo` more flexible, a number of new methods have been made available that make it possible to attach almost arbitrary objects to an `~lsst.afw.image.ExposureInfo` instance.
This makes it much more convenient to extend `~lsst.afw.image.ExposureInfo` to address new use cases.
This change is fully backwards compatible with the old `~lsst.afw.image.ExposureInfo` interface.
For more details and usage instructions, refer to `this community.lsst.org post`__.

__ https://community.lsst.org/t/changes-to-exposureinfo/3788

.. _release-v19-0-0-gen3-api:

“Gen 3”-driven changes to loading reference catalogs
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The “Generation 3” middleware :ref:`included in the 17.0.0 release <release-v17-0-gen3>` is undergoing rapid development, and some API instability is to be expected: these notes will not attempt to produce a comprehensive guide to all of the changes.
However, it is worth nothing that, as of :jira:`DM-17023`, tasks which derive from *both* `~lsst.pipe.base.CmdLineTask` and `~lsst.pipe.base.PipelineTask` now have *separate* configuration options for specifying reference catalog configuration depending on whether they are being executed by “Gen 2” or “Gen 3” middleware.
Further, these options must be manually kept synchronized.
For more details and instructions, refer to `this community.lsst.org post`__.

__ https://community.lsst.org/t/gen3-api-changes-and-configuring-reference-catalogs/3854/3

.. _release-v19-0-0-pipetask:

``pipetask`` interface changes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The ``pipetask`` command is used to invoke processing based on the `~lsst.pipe.base.PipelineTask` middleware.
Its command-line interface has been overhauled in this release, adding a number of new capabilities and changing the ordering of sub-commands and some options.
These changes are described in `this community.lsst.org post`__.

__ https://community.lsst.org/t/pipetask-command-line-interface-changes/3923

.. _release-v19-0-0-isr:

Replacement of functions in `lsst.ip.isr`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

As `announced in the 18.0.0 release notes <release-v18-0-0-deprecate-isr>`, a number of functions formerly provided in `lsst.ip.isr` have been removed.
They are replaced by functionality in `lsst.meas.algorithms.Defects`.
Specifically:

- ``defectListFromFootprintList`` is replaced by `lsst.meas.algorithms.Defects.fromFootPrintList`
- ``transposeDefectList`` is replaced by `lsst.meas.algorithms.Dfects.transpose`
- ``maskPixelsFromDefectList`` is replaced by `lsst.meas.algorithms.Dfects.maskPixels`
- ``getDefectListFromMask`` is replaced by `lsst.meas.algorithms.Dfects.fromMask`

.. _release-v19-0-0-calib-compat:

Removal of `lsst.afw.image.Calib` compatibility API
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

As `announced in the 18.0.0 release notes <release-v18-0-0-deprecate-calib>`, the compatibility layer for the now-removed `~lsst.afw.image.Calib` API has been removed.

.. _release-v19-0-0-ap-silent:

Removal of the ``--silent`` command-line option from ap_verify
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The ``--silent`` option to ap_verify did nothing, and was maintained only for backwards compatibility reasons.
As `announced in the 18.0.0 release notes <release-v18-0-0-deprecate-ap-silent>`, it has now been removed.

.. _release-v19-0-0-test-util:

Removal of deprecated test utility functions
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The following functions have been removed from the `lsst.utils` package:

- `lsst.utils.tests.run`
- `lsst.utils.tests.assertRaisesLsstCpp`
- `lsst.utils.tests.assertClose`
- `lsst.utils.tests.assertNotClose`

The class `lsst.utils.tests.TestDeprecations` has also been removed.
All of this code had been deprecated several releases in the past.

.. _release-v19-0-0-pytest:

Removal of the pytest EUPS package
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The `pytest <https://pytest.org/>`_ unit testing framework is no longer installed by EUPS as part of the Science Pipelines software distribution.
It is still required, and must be provided through the environment.
The standard Science Pipelines Conda environment (as installed by e.g. :ref:`newinstall.sh <newinstall-run>` with the default options) provides a suitable version of pytest.

.. _release-v19-0-0-adn:

Removal of meas_extensions_astrometryNet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The meas_extensions_astrometryNet package was unused in the Science Pipelines codebase, and was included only through a vestigial dependency.
This has now been dropped, and hence meas_extensions_astrometryNet does not appear in this release.

.. _release-v19-0-0-mosaic:

Removal of meas_mosaic
^^^^^^^^^^^^^^^^^^^^^^

:ref:`Jointcal <lsst.jointcal>` now provides all the features necessary to replace meas_mosaic, and has been successfully tested in at-scale data processing.
The meas_mosaic package has therefore been removed from the Science Pipelines codebase, and does not appear in this release.

.. _release-v19-0-0-citizen:

Removal of :cpp:class:`lsst::daf::base::Citizen`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:cpp:class:`~lsst::daf::base::Citizen`, an obsolete system for debugging memory leaks in C++ code, has been removed per :jira:`RFC-280`.

.. _release-v19-0-0-pending-deprecations:

Pending Deprecations
--------------------

These packages/functions will be deprecated in the next major release.

- :ref:`release-v19-0-0-deprecate-gen2`
- :ref:`release-v19-0-0-deprecate-makeDistortedTanWcs`

.. _release-v19-0-0-deprecate-gen2:

Upcoming removal of “Generation 2” Middleware
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The “Generation 3” middleware :ref:`included in the 17.0.0 release <release-v17-0-gen3>` is ultimately intended to supplant the current (“Generation 2”) Data Butler and command-line task functionality.
We expect to deliver a final major release supporting the Generation 2 functionality early in calendar year 2020.
Following that release, the “Generation 2” middleware will be removed from the codebase.
This will include:

- The daf_persistence package, to be replaced by daf_butler;
- `lsst.pipe.base.CmdLineTask`, to be replaced by `lsst.pipe.base.PipelineTask`;
- The pipe_drivers and ctrl_pool packages, for which replacements are still in development.

.. _release-v19-0-0-deprecate-makeDistortedTanWcs:

Upcoming removal of `lsst.afw.geom.wcsUtils.makeDistortedTanWcs`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Camera geometry-based distortions are now automatically incorporated into the WCS automatically when reading raw data, rendering `~lsst.afw.geom.wcsUtils.makeDistortedTanWcs` obsolete.
The function ``makeDistortedTanWcs`` will be removed after release 20.

.. _release-v19-0-0-deprecations:

Deprecations
------------

These packages/functions are deprecated and will not be available in the next major release.

- :ref:`release-v19-0-0-deprecate-lsstsim`
- :ref:`release-v19-0-0-deprecate-afwGeom`
- :ref:`release-v19-0-0-deprecate-PixelScaleBoundedField`
- :ref:`release-v19-0-0-deprecate-addDistortionModel`
- :ref:`release-v19-0-0-deprecate-_extractAmpId`
- :ref:`release-v19-0-0-deprecate-pex_policy`
- :ref:`release-v19-0-0-deprecate-astrometry_net_data`
- :ref:`release-v19-0-0-deprecate-getHasRawInfo`
- :ref:`release-v19-0-0-deprecate-pixelScale`

.. _release-v19-0-0-deprecate-lsstSim:

Removal of the obs_lsstSim package
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The obs_lsst package, :ref:`included in the release 17 <release-v17-0-obs-lsst>`, obviates the need for the obs_lsstSim package.
This package will be removed before the release of version 20.0.0.

.. _release-v19-0-0-deprecate-afwGeom:

Removal of `lsst.afw.geom` classes that have been relocated to `lsst.geom`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

As announced in v16.0 (:ref:`release-v16-0-new-geom`) some primitives have been moved from `afw.geom` to `geom`.
We currently provide aliases for compatibility purposes, but new all code should use the `geom` package directly.
The aliases will be removed before the release of version 20.0.0.

.. _release-v19-0-0-deprecate-PixelScaleBoundedField:

Removal of `lsst.afw.math.PixelScaleBoundedField`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

`~lsst.afw.math.PixelAreaBoundedField`, :ref:`added in this release <release-v19-0-0-PixelAreaBoundedField>`, is intended to replace `~lsst.afw.math.PixelScaleBoundedField`.
The latter will be removed before the release of version 20.0.0.

.. _release-v19-0-0-deprecate-addDistortionModel:

Removal of `lsst.ip.isr.addDistortionModel` and related configuration classes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Camera geometry-based distortions are now automatically incorporated into the WCS automatically when reading raw data, rendering this functionality obsolete.
It will be removed before the release of version 20.0.0.

.. _release-v19-0-0-deprecate-_extractAmpId:

Removal of `lsst.obs.base.CameraMapper._extractAmpId`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This method is no longer used and will be removed before the release of version 20.0.0.

.. _release-v19-0-0-deprecate-pex_policy:

Removal of `pex_policy`
^^^^^^^^^^^^^^^^^^^^^^^

The pex_policy package is obsolete, and will be removed in version 20.0.0.
Calls to `lsst.pex.policy.makePolicy` should be modernized to become calls to `lsst.pex.config.makePropertySet`.
See also :jira:`RFC-626`.

.. _release-v19-0-0-deprecate-astrometry_net_data:

Removal of astrometry_net_data
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The astrometry_net_data package is obsolete, and will be removed in version 20.0.0.

.. _release-v19-0-0-deprecate-getHasRawInfo:

Removal of `lsst.afw.cameraGeom.Amplifier.getHasRawInfo`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

`~lsst.afw.cameraGeom.Amplifier.getHasRawInfo` is redundant, since amplifier objects *always* have raw information.
It will be removed before the release of version 20.0.0

.. _release-v19-0-0-deprecate-pixelScale:

Removal of `lsst.fgcmcal.FgcmFitCycleConfg.pixelScale`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This configuration field is no longer used, and therefore will be removed before the release of version 20.0.0.
